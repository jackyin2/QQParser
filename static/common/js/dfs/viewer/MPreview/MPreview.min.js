/**
 * @name     MPreview.js
 * @desc     文档预览。
 * @depend   jQuery 1.7+, jQuery.MouseWheel.js
 * @author   M.J
 * @date     2014-12-25
 * @URL      http://webjyh.com
 * @reutn    {jQuery}
 * @version  1.0.1
 *
 * @PS If you have any questions, please don't look for me, I don't know anything. thank you.
 */
(function(b){var a=function(d,c){this.config=b.extend({},this.defaults,c);this.elem=b(d);this.page=0;this.bout=0;this.offset=0;this.btnOffset=0;this.length=0;this.data=[];this.H=[];this.DOM=this.__createDOM();this.S={width:this.elem.width(),height:this.elem.height()};this.__init()};a.prototype={defaults:{url:null,data:null,offset:100,loadSize:5,pageFix:50,scrollFix:5,minScrollHeight:20},__init:function(){var d=this,c=this.DOM;if(this.config.data&&this.config.data.length){this.__set(this.config.data).__create().__addEvent()}else{b.getJSON(this.config.url).done(function(e){if(e.code>0&&e.imgs.length){d.__set(e.imgs).__create().__addEvent()}}).fail(function(){alert("\u83b7\u53d6\u6570\u636e\u5931\u8d25")})}return this},__set:function(d){var c=this.DOM;this.data=d;this.length=d.length;c.pageInput.val("01");c.pageCount.children("em").text(this.__formatNumber(this.length));if(this.length>1){c.pageNext.addClass("current")}return this},__create:function(){if(!this.data.length){return false}b(document).off("mousemove");var e=0,d="",c=this.data.length,g=c>this.config.loadSize?this.config.loadSize:c,f=this.DOM,h=this;for(;e<g;e++){d+=a.tpl.replace("{src}",this.data.shift())}b(d).appendTo(f.mediaView).find("img").each(function(j){b(this).load(function(){var i=(typeof h.H[h.H.length-1]==="undefined"?0:h.H[h.H.length-1])+b(this).parent().outerHeight();h.H.push(i);h.__scrollBar()})});return this},__scrollBar:function(){var g=this.__getSize(),i=this.DOM;if(g.viewHeight<g.height){i.scrollBar.hide();return false}var j=this,h=this.config.offset,f;this.bout=(g.viewHeight-g.height)/h;var e=((g.height-this.config.scrollFix*2)/g.viewHeight)*g.height;this.btnOffset=(g.height-(this.config.scrollFix*2)-e)/this.bout;var d=function(m){var k=j.config.scrollFix,l=j.btnOffset*j.offset==0&&m=="up"?k:j.btnOffset*j.offset;f=j.offset*h;i.mediaView.css("margin-top",-f);i.scrollBtn.css("top",l+(m=="up"?0:k))};var c=function(k){k=="up"?++j.offset:--j.offset;if(k=="up"&&j.offset>j.bout){j.offset=j.bout}if(k=="down"&&j.offset<0){j.offset=0}d(k);if(k=="up"&&f+j.config.pageFix>j.H[j.page]){i.pageInput.val(j.__formatNumber(++j.page+1))}if(k=="down"&&f+j.config.pageFix<j.H[j.page-1]){i.pageInput.val(j.__formatNumber(--j.page+1))}j.__createLastData()};i.scrollBtn.height(e<=this.config.minScrollHeight?this.config.minScrollHeight:e);i.scrollBtn.css("top",j.btnOffset*j.offset+j.config.scrollFix);i.mediaPlay.off("mousewheel").on("mousewheel",function(k){k.preventDefault();c(k.deltaY<0?"up":"down")});return this},__scrollDrag:{dragStart:function(e,f){var d=f.DOM,c=(e.clientY-d.scrollBtn.offset().top).toFixed(0);b(document).on("mousemove",function(g){f.__scrollDrag.dragDrop(g,c,f)});b(document).off("mouseup").on("mouseup",function(){b(this).off("mousemove")})},dragDrop:function(c,i,k){var m=k.DOM,n=k.__getSize(),e=parseInt(m.scrollBtn.css("top"),10),h=(c.clientY-m.scrollBtn.offset().top).toFixed(0)-i,l=e+h,g=k.config.scrollFix,j=n.height-k.config.scrollFix-m.scrollBtn.outerHeight();if(l<g){l=g}if(l>j){l=j}var f=Math.floor(l/k.btnOffset),d=Math.floor((n.viewHeight-k.config.scrollFix*2)/n.height)*(l==g?0:l);if(l==j){d=n.viewHeight-n.height}k.offset=f>k.bout?k.bout:f;if(d+k.config.pageFix>k.H[k.page]){m.pageInput.val(k.__formatNumber(++k.page+1))}if(d+k.config.pageFix<k.H[k.page-1]){m.pageInput.val(k.__formatNumber(--k.page+1))}m.mediaView.css("margin-top",-d);m.scrollBtn.css("top",l);k.__createLastData()}},__addEvent:function(){var f=this,c=this.DOM;var e=function(){if(f.page>0){c.arrowTop.stop(true,true).fadeIn()}if(f.page<f.length-1){c.arrowBottom.stop(true,true).fadeIn()}};var d=function(){c.arrowTop.stop(true,true).fadeOut();c.arrowBottom.stop(true,true).fadeOut()};c.scrollBtn.on("mousedown",function(g){f.__scrollDrag.dragStart(g,f)});c.arrowUp.on("mouseover",e);c.arrowDown.on("mouseover",e);c.arrowUp.on("mouseout",d);c.arrowDown.on("mouseout",d);c.arrowTop.on("click",function(){f.__pageJump("up")});c.pagePrev.on("click",function(){f.__pageJump("up")});c.arrowBottom.on("click",function(){f.__pageJump("down")});c.pageNext.on("click",function(){f.__pageJump("down")});c.fullScreen.on("click",function(){f.__full()});c.mediaPlay.on("dblclick",function(){f.__full()});return this},__pageJump:function(j){j=="up"?--this.page:++this.page;if(this.page<0){this.page=0}if(this.page>this.length-1){this.page=this.length-1}var h=this.DOM,f=this.__getSize(),e=typeof this.H[this.page-1]==="undefined"?0:this.H[this.page-1],g=this.config.scrollFix,c=f.height-h.scrollBtn.outerHeight()-g;var d,i=(e/this.config.offset==0)?0:Math.floor(e/this.config.offset);this.offset=i>this.bout?this.bout:i;d=this.offset*this.btnOffset;if(d<g){d=g}if(d>c){d=c}h.pageInput.val(this.__formatNumber(this.page+1));h.mediaView.css("margin-top",-e);h.scrollBtn.css("top",d);this.__createLastData()},__full:function(d){var c=this.elem,n=this.DOM,h=this,m=n.fullScreen.hasClass("MPreview-exit"),e=b(window).outerHeight();if(d){m=false}var g={position:m?"static":"fixed",top:m?"auto":0,left:m?"auto":0,zIndex:m?"0":9999,width:m?this.S.width:"100%",height:m?this.S.height:e},i={overflow:m?"auto":"hidden",width:m?"auto":"100%",height:m?"auto":e};n.fullScreen[m?"removeClass":"addClass"]("MPreview-exit").attr("title",m?"\u5168\u5c4f":"\u53d6\u6d88\u5168\u5c4f");b("html").css(i);c.css(g);var k=function(){return h.bout}();this.H=[];n.mediaView.find("img").each(function(p){var o=(typeof h.H[h.H.length-1]==="undefined"?0:h.H[h.H.length-1])+b(this).parent().outerHeight();h.H.push(o)});this.__scrollBar();var f=((this.bout-k)*this.config.offset/k)*this.offset,l=f/this.config.offset,j=parseInt(n.mediaView.css("margin-top"),10);this.offset=this.offset+l;n.mediaView.css("margin-top",j+(-f));n.scrollBtn.css("top",h.btnOffset*h.offset+h.config.scrollFix);if(m){b(document).off("keyup");b(window).off("resize")}else{b(document).on("keyup",function(o){if(o.which==27){h.__full()}});b(window).off("resize").on("resize",function(){h.__full(true)})}},__formatNumber:function(c){return c.toString().length<2?"0"+c:c},__createLastData:function(){var c=this.DOM;c.pagePrev[this.page>0?"addClass":"removeClass"]("current");c.pageNext[this.page<this.length-1?"addClass":"removeClass"]("current");if(this.offset>=Math.floor(this.bout)-1){this.__create()}},__createDOM:function(){var c=this.elem,e={},d;e.wrap=b(a.template).appendTo(c);e.wrap.find("*").each(function(){var g=b(this).attr("class");if(g!==undefined&&g.toString().indexOf("MPreview")>-1){var f=g.replace(/icon /g,"").replace("MPreview-","");e[f]=b(this)}});return e},__getSize:function(){var c=this.DOM;return{width:c.mediaPlay.width(),height:c.mediaPlay.height(),viewWidth:c.mediaView.width(),viewHeight:c.mediaView.height()}}};a.tpl='<div><img src="{src}" /></div>';a.template='<div class="MPreview-box"><div class="tool-bar clefix"><ul class="clefix"><li><a href="javascript:void(0);" class="MPreview-fullScreen" title="\u5168\u5c4f"><span>\u5168\u5c4f</span></a></li></ul></div><div class="MPreview-scrollBar"><div class="MPreview-scrollBtn"></div></div><div class="MPreview-mediaPlay"><div class="MPreview-mediaView"></div></div><div class="page-bar"><div class="page-bar-inner clefix"><a href="javascript:void(0);" class="MPreview-pagePrev" title="\u4e0a\u4e00\u9875"><span>\u4e0a\u4e00\u9875</span></a> <input type="text" name="page" class="MPreview-pageInput" value="0" maxlength="5" disabled="disabled"> <span class="MPreview-pageCount">/&nbsp;&nbsp;<em>0</em></span> <a href="javascript:void(0);" class="MPreview-pageNext" title="\u4e0b\u4e00\u9875"><span>\u4e0b\u4e00\u9875</span></a></div></div><div class="MPreview-arrowUp"><div href="javascript:void(0);" class="MPreview-arrowTop" title="\u4e0a\u4e00\u9875"><span>\u4e0a\u4e00\u9875</span></div></div><div class="MPreview-arrowDown"><div href="javascript:void(0);" class="MPreview-arrowBottom" title="\u4e0b\u4e00\u9875"><span>\u4e0b\u4e00\u9875</span></div></div></div>';b.fn.MPreview=function(c){return this.each(function(){new a(this,c)})}})(jQuery);
/*!
 * jQuery Mousewheel 3.1.12
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
(function(a){a(jQuery)}(function(c){var d=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],k=("onwheel" in document||document.documentMode>=9)?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice,j,b;if(c.event.fixHooks){for(var e=d.length;e;){c.event.fixHooks[d[--e]]=c.event.mouseHooks}}var f=c.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener){for(var m=k.length;m;){this.addEventListener(k[--m],l,false)}}else{this.onmousewheel=l}c.data(this,"mousewheel-line-height",f.getLineHeight(this));c.data(this,"mousewheel-page-height",f.getPageHeight(this))},teardown:function(){if(this.removeEventListener){for(var m=k.length;m;){this.removeEventListener(k[--m],l,false)}}else{this.onmousewheel=null}c.removeData(this,"mousewheel-line-height");c.removeData(this,"mousewheel-page-height")},getLineHeight:function(m){var i=c(m),n=i["offsetParent" in c.fn?"offsetParent":"parent"]();if(!n.length){n=c("body")}return parseInt(n.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(i){return c(i).height()},settings:{adjustOldDeltas:true,normalizeOffset:true}};c.fn.extend({mousewheel:function(i){return i?this.bind("mousewheel",i):this.trigger("mousewheel")},unmousewheel:function(i){return this.unbind("mousewheel",i)}});function l(i){var o=i||window.event,u=h.call(arguments,1),w=0,q=0,p=0,t=0,s=0,r=0;i=c.event.fix(o);i.type="mousewheel";if("detail" in o){p=o.detail*-1}if("wheelDelta" in o){p=o.wheelDelta}if("wheelDeltaY" in o){p=o.wheelDeltaY}if("wheelDeltaX" in o){q=o.wheelDeltaX*-1}if("axis" in o&&o.axis===o.HORIZONTAL_AXIS){q=p*-1;p=0}w=p===0?q:p;if("deltaY" in o){p=o.deltaY*-1;w=p}if("deltaX" in o){q=o.deltaX;if(p===0){w=q*-1}}if(p===0&&q===0){return}if(o.deltaMode===1){var v=c.data(this,"mousewheel-line-height");w*=v;p*=v;q*=v}else{if(o.deltaMode===2){var n=c.data(this,"mousewheel-page-height");w*=n;p*=n;q*=n}}t=Math.max(Math.abs(p),Math.abs(q));if(!b||t<b){b=t;if(a(o,t)){b/=40}}if(a(o,t)){w/=40;q/=40;p/=40}w=Math[w>=1?"floor":"ceil"](w/b);q=Math[q>=1?"floor":"ceil"](q/b);p=Math[p>=1?"floor":"ceil"](p/b);if(f.settings.normalizeOffset&&this.getBoundingClientRect){var m=this.getBoundingClientRect();s=i.clientX-m.left;r=i.clientY-m.top}i.deltaX=q;i.deltaY=p;i.deltaFactor=b;i.offsetX=s;i.offsetY=r;i.deltaMode=0;u.unshift(i,w,q,p);if(j){clearTimeout(j)}j=setTimeout(g,200);return(c.event.dispatch||c.event.handle).apply(this,u)}function g(){b=null}function a(m,i){return f.settings.adjustOldDeltas&&m.type==="mousewheel"&&i%120===0}}));